<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>The init Function</title> 
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- html,frames,3 --> 
<meta name="src" content="QubistHTML.tex"> 
<meta name="date" content="2012-02-01 01:22:00"> 
<link rel="stylesheet" type="text/css" href="QubistHTML.css"> 
</head><body 
>
<!--l. 1488--><div class="crosslinks"><p class="noindent">[<a 
href="QubistHTMLse17.html" >next</a>] [<a 
href="QubistHTMLse15.html" >prev</a>] [<a 
href="QubistHTMLse15.html#tailQubistHTMLse15.html" >prev-tail</a>] [<a 
href="#tailQubistHTMLse16.html">tail</a>] [<a 
href="QubistHTMLch4.html#QubistHTMLse16.html" >up</a>] </p></div>
<h3 class="sectionHead"><span class="titlemark">4.6   </span> <a 
 id="x30-410004.6"></a>The init Function</h3>
<a 
 id="dx30-41001"></a>
<a 
 id="dx30-41002"></a>
<a 
 id="dx30-41003"></a>
<a 
 id="dx30-41004"></a>
<a 
 id="dx30-41005"></a>
<a 
 id="dx30-41006"></a>
<!--l. 1497--><p class="noindent" >The &#8216;init&#8217; field in the user projects section of the launcher file contains the name of an initialization m-file for your
project. If this field is found, then Ferret will call this m-file <span 
class="cmti-10">once </span>during the initialization of your project. This is
where you should load any additional paths required for the project, <span 
class="cmti-10">including sub-directories of the project</span>
<span 
class="cmti-10">directory</span><span class="footnote-mark"><a 
href="QubistHTML31.html#fn3x10"><sup class="textsuperscript">3</sup></a></span><a 
 id="x30-41007f3"></a> ,
and any code that only needs to be called once during the run. A good example is if your calculation
requires static data to be loaded from disk, which might also require some pre-processing. Loading
and processing data are often time-consuming operations and should not be done in the fitness file,
since this is called multiple times each generation. It is better to load the data set in an init.m file,
and pass the data to the fitness file though Ferrets external parameter mechanism. This works as
follows:
     <ol  class="enumerate1" >
     <li 
  class="enumerate" id="x30-41009x1">
     The
     name
     of
     the
     init
     file
     is
     arbitrary,
     and
     is
     given
     by
     the
                                                                                         

                                                                                         
     character
     string
     defined
     by
     <span 
class="cmtt-10">projects</span><span 
class="cmsy-10">{</span><span 
class="cmtt-10">n</span><span 
class="cmsy-10">}</span><span 
class="cmtt-10">.init</span>,
     where
     <span 
class="cmmi-10">n</span>
     is
     the
     project
     number.
     The
     customary
     name
     (and
     the
     name
     of
     the
     init
     file
     for
     all
     demos
     that
     require
     one)
     is
     &#8216;init.m&#8217;,
     but
     any
     name
     can
     be
     used.
     The
     init
     file
     must
     reside
     in
     the
     project
     directory.
     </li>
     <li 
  class="enumerate" id="x30-41011x2">
                                                                                         

                                                                                         
     The
     init
     function
     accepts
     no
     arguments
     and
     creates
     a
     MATLAB
     structure
     that
     is
     customarily
     called
     &#8216;extPar&#8217;,
     which
     stands
     for
     &#8216;external
     parameters&#8217;.
     The
     parameters
     are
     considered
     external
     because
     they
     belong
     to
     the
     project,
     and
     are
     therefore
     external
     to
     Ferret,
     while
     Ferret&#8217;s
     internal
     parameters
     are
     called
     &#8216;par&#8217;.
     The
     <span 
class="cmmi-10">extPar</span>
     structure
                                                                                         

                                                                                         
     is
     passed
     to
     Ferret
     by
     one
     of
     two
     methods,
     depending
     on
     whether
     you
     use
     the
     standard
     technique,
     or
     a
     less
     commonly
     used
     one
     that
     relies
     on
     global
     variables.</li></ol>
<h4 class="subsectionHead"><span class="titlemark">4.6.1   </span> <a 
 id="x30-420004.6.1"></a>The Standard Technique</h4>
<a 
 id="dx30-42001"></a>
<!--l. 1507--><p class="noindent" >The usual method for defining an init file is to write a function with the following signature:
<!--l. 1512--><p class="noindent" ><span 
class="colorbox" id="colorbox11"> <div class="minipage"><div class="BVerbatimInput"><span 
class="cmtt-10">function</span><span 
class="cmtt-10">&#x00A0;extPar=init</span></div>
</div></span>
<!--l. 1518--><p class="noindent" >The <span 
class="cmmi-10">extPar </span>structure is passed back to Ferret when init is called, and the entire <span 
class="cmmi-10">extPar </span>structure will be available
to your fitness function when it is evaluated. <a 
 id="dx30-42003"></a>
<!--l. 1522--><p class="noindent" >
<h4 class="subsectionHead"><span class="titlemark">4.6.2   </span> <a 
 id="x30-430004.6.2"></a>Advanced Technique: <span 
class="cmmi-10">extPar</span>_ as a Global Variable</h4>
<a 
 id="dx30-43001"></a>
<a 
 id="dx30-43002"></a>
                                                                                         

                                                                                         
<a 
 id="dx30-43003"></a>
<a 
 id="dx30-43004"></a>
<!--l. 1529--><p class="noindent" >The standard method passes <span 
class="cmmi-10">extPar </span>to your fitness function as a local variable, as discussed in Section <a 
href="#x30-420004.6.1">4.6.1<!--tex4ht:ref: sec:localExtpar --></a>. This is
the preferred method, and works well for most problems. However, there is also an advanced technique to make the
data from your init file accessible as a global variable called <span 
class="cmmi-10">extPar</span>_. I developed this method for a specific
problem, which called SAMOSA to handle an internal optimization of a sub-problem <span 
class="cmti-10">inside </span>of a Ferret fitness
function. It is possible to handle this problem using the standard local variable technique, but this
comes at a heavy price. The problem is that Ferret and SAMOSA each have their own <span 
class="cmmi-10">par </span>structure,
and <span 
class="cmmi-10">extPar </span>is carried inside <span 
class="cmmi-10">par </span>as <span 
class="cmtt-10">par.user.extPar</span>. This means that a problem like this requires
<span 
class="cmti-10">two </span>copies of <span 
class="cmmi-10">extPar</span>: Ferret&#8217;s <span 
class="cmtt-10">par.user.extPar </span>and SAMOSA&#8217;s <span 
class="cmtt-10">par.user.extPar</span>, and they can&#8217;t
be shared. This can be expensive in terms of memory if <span 
class="cmmi-10">extPar </span>contains a lot of data, as it often
does. This situation is much better handled by storing the data from the init file in a global variable
called <span 
class="cmmi-10">extPar</span>_ that can be accessed by both Ferret and SAMOSA (or Anvil), and excluding it from
<span 
class="cmtt-10">par.user.extPar</span>.
<!--l. 1531--><p class="noindent" >Let me offer this advice on the global <span 
class="cmmi-10">extPar</span>_ technique. Please don&#8217;t use this as your standard technique for
sending <span 
class="cmmi-10">extPar</span>_ to your fitness function. Global variables are considered to be bad form by most programmers, and
can lead to confusion when debugging. The standard method based on passing <span 
class="cmmi-10">extPar</span>_ as a local variable is the
established technique, and is known to be robust. I believe that the global <span 
class="cmmi-10">extPar</span>_ technique is reliable, but it has
not yet been tested nearly as thoroughly as the standard method. It should be reserved for weird situations when
you <span 
class="cmti-10">really </span>need it.
<a 
 id="dx30-43005"></a>
<a 
 id="dx30-43006"></a>
<a 
 id="dx30-43007"></a>
<a 
 id="dx30-43008"></a>
<a 
 id="dx30-43009"></a>
<a 
 id="dx30-43010"></a>
<a 
 id="dx30-43011"></a>
<!--l. 1540--><p class="noindent" >I have included an example of this technique in the demo titled &#8216;Advanced/Ferret-SAMOSA-Anvil Insanity&#8217;, which
is designed for Ferret but also works with Locust. The name reflects the confusion that can result when
embedding one optimization inside of another if you are not careful about it (and sometimes even if you
are). The following instructions are slightly adapted from the Notes.txt file in the demo directory:
[Qubist_Home]/demos/Advanced/Ferret-SAMOSA-Anvil-Insanity/Notes.txt.
<!--l. 1542--><p class="noindent" >
     <ol  class="enumerate1" >
     <li 
  class="enumerate" id="x30-43013x1">Write a single init file that contains everything. You should define <span 
class="cmmi-10">extPar</span>_ as a global variable, and you do
     not need to return <span 
class="cmmi-10">extPar </span>from the init function:
     <!--l. 1549--><p class="noindent" ><span 
class="colorbox" id="colorbox12"> <div class="minipage"><div class="BVerbatimInput"><span 
class="cmtt-10">function</span><span 
class="cmtt-10">&#x00A0;init</span><br /><span 
class="cmtt-10">global</span><span 
class="cmtt-10">&#x00A0;extPar_</span></div>
     </div></span>
     </li>
     <li 
  class="enumerate" id="x30-43017x2">Write separate fitness functions for Ferret and for the internal optimization problem. Give these good names to
     avoid confusion. The demo uses &#8216;fitnessFerret&#8217; and &#8216;fitnessInternal&#8217; respectively for the Ferret fitness
     function and the fitness function for the internal problem, which is optimized by either SAMOSA or
     Anvil.
     </li>
                                                                                         

                                                                                         
     <li 
  class="enumerate" id="x30-43019x3">Create a separate FerretSetup and a setup file for the internal optimization: either SAMOSA_setup to use
     SAMOSA, or AnvilSetup to use Anvil. The FerretSetup file must call call the SAMOSA_setup or AnvilSetup
     file by the following steps: <a 
 id="dx30-43020"></a><a 
 id="dx30-43021"></a> <a 
 id="dx30-43022"></a>
     <!--l. 1605--><p class="noindent" ><span 
class="colorbox" id="colorbox13"> <div class="minipage"><div class="BVerbatimInput"><span 
class="cmtt-10">%</span><span 
class="cmtt-10">&#x00A0;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@</span><br /><span 
class="cmtt-10">%</span><span 
class="cmtt-10">&#x00A0;@</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;EXTRA</span><span 
class="cmtt-10">&#x00A0;SETUP</span><span 
class="cmtt-10">&#x00A0;INFO</span><span 
class="cmtt-10">&#x00A0;FOR</span><span 
class="cmtt-10">&#x00A0;SAMOSA</span><span 
class="cmtt-10">&#x00A0;AND</span><span 
class="cmtt-10">&#x00A0;Anvil</span><br /><span 
class="cmtt-10">%</span><span 
class="cmtt-10">&#x00A0;@</span><span 
class="cmtt-10">&#x00A0;All</span><span 
class="cmtt-10">&#x00A0;extra</span><span 
class="cmtt-10">&#x00A0;setup</span><span 
class="cmtt-10">&#x00A0;info</span><span 
class="cmtt-10">&#x00A0;MUST</span><span 
class="cmtt-10">&#x00A0;go</span><span 
class="cmtt-10">&#x00A0;into</span><span 
class="cmtt-10">&#x00A0;par.user</span><span 
class="cmtt-10">&#x00A0;if</span><span 
class="cmtt-10">&#x00A0;you</span><span 
class="cmtt-10">&#x00A0;want</span><br /><span 
class="cmtt-10">%</span><span 
class="cmtt-10">&#x00A0;@</span><span 
class="cmtt-10">&#x00A0;this</span><span 
class="cmtt-10">&#x00A0;demo</span><span 
class="cmtt-10">&#x00A0;to</span><span 
class="cmtt-10">&#x00A0;also</span><span 
class="cmtt-10">&#x00A0;work</span><span 
class="cmtt-10">&#x00A0;with</span><span 
class="cmtt-10">&#x00A0;Locust.</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;par.user</span><span 
class="cmtt-10">&#x00A0;is</span><span 
class="cmtt-10">&#x00A0;copied</span><br /><span 
class="cmtt-10">%</span><span 
class="cmtt-10">&#x00A0;@</span><span 
class="cmtt-10">&#x00A0;into</span><span 
class="cmtt-10">&#x00A0;LocustSetup</span><span 
class="cmtt-10">&#x00A0;verbatim</span><span 
class="cmtt-10">&#x00A0;by</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;translation</span><span 
class="cmtt-10">&#x00A0;program</span><br /><span 
class="cmtt-10">%</span><span 
class="cmtt-10">&#x00A0;@</span><span 
class="cmtt-10">&#x00A0;translateFerretToLocust.</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;Other</span><span 
class="cmtt-10">&#x00A0;user-defined</span><span 
class="cmtt-10">&#x00A0;fields</span><span 
class="cmtt-10">&#x00A0;are</span><br /><span 
class="cmtt-10">%</span><span 
class="cmtt-10">&#x00A0;@</span><span 
class="cmtt-10">&#x00A0;not</span><span 
class="cmtt-10">&#x00A0;copied.</span><br /><span 
class="cmtt-10">%</span><span 
class="cmtt-10">&#x00A0;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@</span><br /><span 
class="cmtt-10">%</span><br /><span 
class="cmtt-10">%</span><span 
class="cmtt-10">&#x00A0;!!!!!</span><span 
class="cmtt-10">&#x00A0;ADD</span><span 
class="cmtt-10">&#x00A0;SETUP</span><span 
class="cmtt-10">&#x00A0;INFO</span><span 
class="cmtt-10">&#x00A0;FOR</span><span 
class="cmtt-10">&#x00A0;SAMOSA.</span><span 
class="cmtt-10">&#x00A0;!!!!!</span><br /><span 
class="cmtt-10">%</span><span 
class="cmtt-10">&#x00A0;This</span><span 
class="cmtt-10">&#x00A0;info</span><span 
class="cmtt-10">&#x00A0;is</span><span 
class="cmtt-10">&#x00A0;required</span><span 
class="cmtt-10">&#x00A0;for</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;SAMOSA</span><span 
class="cmtt-10">&#x00A0;call</span><span 
class="cmtt-10">&#x00A0;that</span><span 
class="cmtt-10">&#x00A0;is</span><span 
class="cmtt-10">&#x00A0;embedded</span><span 
class="cmtt-10">&#x00A0;in</span><span 
class="cmtt-10">&#x00A0;Ferret&#8217;s</span><br /><span 
class="cmtt-10">%</span><span 
class="cmtt-10">&#x00A0;fitness</span><span 
class="cmtt-10">&#x00A0;function.</span><br /><span 
class="cmtt-10">%</span><br /><span 
class="cmtt-10">%</span><span 
class="cmtt-10">&#x00A0;Load</span><span 
class="cmtt-10">&#x00A0;an</span><span 
class="cmtt-10">&#x00A0;INCOMPLETE</span><span 
class="cmtt-10">&#x00A0;default</span><span 
class="cmtt-10">&#x00A0;setup</span><span 
class="cmtt-10">&#x00A0;file</span><span 
class="cmtt-10">&#x00A0;from</span><br /><span 
class="cmtt-10">%</span><span 
class="cmtt-10">&#x00A0;Qubist/user/Ferret/defaults/defaultSAMOSA_setup.</span><br /><span 
class="cmtt-10">par.user.SAMOSA_par=defaultSAMOSA_setup;</span><br /><span 
class="cmtt-10">%</span><br /><span 
class="cmtt-10">%</span><span 
class="cmtt-10">&#x00A0;Add</span><span 
class="cmtt-10">&#x00A0;remaining</span><span 
class="cmtt-10">&#x00A0;fields</span><span 
class="cmtt-10">&#x00A0;by</span><span 
class="cmtt-10">&#x00A0;translating</span><span 
class="cmtt-10">&#x00A0;Ferret</span><span 
class="cmtt-10">&#x00A0;--&#x003E;</span><span 
class="cmtt-10">&#x00A0;SAMOSA.</span><br /><span 
class="cmtt-10">par.user.SAMOSA_par=translateFerretToSAMOSA(par,</span><span 
class="cmtt-10">&#x00A0;par.user.SAMOSA_par);</span><br /><span 
class="cmtt-10">%</span><br /><span 
class="cmtt-10">%</span><span 
class="cmtt-10">&#x00A0;The</span><span 
class="cmtt-10">&#x00A0;translation</span><span 
class="cmtt-10">&#x00A0;program</span><span 
class="cmtt-10">&#x00A0;will</span><span 
class="cmtt-10">&#x00A0;use</span><span 
class="cmtt-10">&#x00A0;Ferret&#8217;s</span><span 
class="cmtt-10">&#x00A0;setup</span><span 
class="cmtt-10">&#x00A0;file</span><span 
class="cmtt-10">&#x00A0;(specifically</span><span 
class="cmtt-10">&#x00A0;the</span><br /><span 
class="cmtt-10">%</span><span 
class="cmtt-10">&#x00A0;par.general.min</span><span 
class="cmtt-10">&#x00A0;and</span><span 
class="cmtt-10">&#x00A0;max</span><span 
class="cmtt-10">&#x00A0;fields)</span><span 
class="cmtt-10">&#x00A0;to</span><span 
class="cmtt-10">&#x00A0;determine</span><span 
class="cmtt-10">&#x00A0;par.general.X0,</span><span 
class="cmtt-10">&#x00A0;and</span><span 
class="cmtt-10">&#x00A0;this</span><br /><span 
class="cmtt-10">%</span><span 
class="cmtt-10">&#x00A0;will</span><span 
class="cmtt-10">&#x00A0;be</span><span 
class="cmtt-10">&#x00A0;wrong</span><span 
class="cmtt-10">&#x00A0;for</span><span 
class="cmtt-10">&#x00A0;SAMOSA.</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;Destroy</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;X0</span><span 
class="cmtt-10">&#x00A0;field</span><span 
class="cmtt-10">&#x00A0;and</span><span 
class="cmtt-10">&#x00A0;let</span><span 
class="cmtt-10">&#x00A0;SAMOSA</span><span 
class="cmtt-10">&#x00A0;sort</span><span 
class="cmtt-10">&#x00A0;it</span><br /><span 
class="cmtt-10">%</span><span 
class="cmtt-10">&#x00A0;out</span><span 
class="cmtt-10">&#x00A0;for</span><span 
class="cmtt-10">&#x00A0;itself.</span><br /><span 
class="cmtt-10">par.user.SAMOSA_par.general.X0=[];</span><br /><span 
class="cmtt-10">%</span><br /><span 
class="cmtt-10">%</span><span 
class="cmtt-10">&#x00A0;Add</span><span 
class="cmtt-10">&#x00A0;modified</span><span 
class="cmtt-10">&#x00A0;fields</span><span 
class="cmtt-10">&#x00A0;from</span><span 
class="cmtt-10">&#x00A0;SAMOSA_setup.</span><br /><span 
class="cmtt-10">par.user.SAMOSA_par=SAMOSA_setup(par.user.SAMOSA_par);</span><br /><span 
class="cmtt-10">%</span><br /><span 
class="cmtt-10">%</span><span 
class="cmtt-10">&#x00A0;====================================</span><br /><span 
class="cmtt-10">%</span><span 
class="cmtt-10">&#x00A0;!!!!!</span><span 
class="cmtt-10">&#x00A0;ADD</span><span 
class="cmtt-10">&#x00A0;SETUP</span><span 
class="cmtt-10">&#x00A0;INFO</span><span 
class="cmtt-10">&#x00A0;FOR</span><span 
class="cmtt-10">&#x00A0;Anvil.</span><span 
class="cmtt-10">&#x00A0;!!!!!</span><br /><span 
class="cmtt-10">%</span><span 
class="cmtt-10">&#x00A0;This</span><span 
class="cmtt-10">&#x00A0;info</span><span 
class="cmtt-10">&#x00A0;is</span><span 
class="cmtt-10">&#x00A0;required</span><span 
class="cmtt-10">&#x00A0;for</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;Anvil</span><span 
class="cmtt-10">&#x00A0;call</span><span 
class="cmtt-10">&#x00A0;that</span><span 
class="cmtt-10">&#x00A0;is</span><span 
class="cmtt-10">&#x00A0;embedded</span><span 
class="cmtt-10">&#x00A0;in</span><span 
class="cmtt-10">&#x00A0;Ferret&#8217;s</span><br /><span 
class="cmtt-10">%</span><span 
class="cmtt-10">&#x00A0;fitness</span><span 
class="cmtt-10">&#x00A0;function.</span><br /><span 
class="cmtt-10">%</span><br /><span 
class="cmtt-10">%</span><span 
class="cmtt-10">&#x00A0;Load</span><span 
class="cmtt-10">&#x00A0;an</span><span 
class="cmtt-10">&#x00A0;INCOMPLETE</span><span 
class="cmtt-10">&#x00A0;default</span><span 
class="cmtt-10">&#x00A0;setup</span><span 
class="cmtt-10">&#x00A0;file</span><span 
class="cmtt-10">&#x00A0;from</span><br /><span 
class="cmtt-10">%</span><span 
class="cmtt-10">&#x00A0;Qubist/user/Ferret/defaults/defaultAnvilSetup.</span><br /><span 
class="cmtt-10">par.user.AnvilPar=defaultAnvilSetup;</span><br /><span 
class="cmtt-10">%</span><br /><span 
class="cmtt-10">%</span><span 
class="cmtt-10">&#x00A0;Add</span><span 
class="cmtt-10">&#x00A0;remaining</span><span 
class="cmtt-10">&#x00A0;fields</span><span 
class="cmtt-10">&#x00A0;by</span><span 
class="cmtt-10">&#x00A0;translating</span><span 
class="cmtt-10">&#x00A0;Ferret</span><span 
class="cmtt-10">&#x00A0;--&#x003E;</span><span 
class="cmtt-10">&#x00A0;Anvil.</span><br /><span 
class="cmtt-10">par.user.AnvilPar=translateFerretToAnvil(par,</span><span 
class="cmtt-10">&#x00A0;par.user.AnvilPar);</span><br /><span 
class="cmtt-10">%</span><br /><span 
class="cmtt-10">%</span><span 
class="cmtt-10">&#x00A0;Add</span><span 
class="cmtt-10">&#x00A0;modified</span><span 
class="cmtt-10">&#x00A0;fields</span><span 
class="cmtt-10">&#x00A0;from</span><span 
class="cmtt-10">&#x00A0;AnvilSetup.</span><br /><span 
class="cmtt-10">par.user.AnvilPar=AnvilSetup(par.user.AnvilPar);</span><br /><span 
class="cmtt-10">%</span><br /><span 
class="cmtt-10">%</span><span 
class="cmtt-10">&#x00A0;====================================</span></div>
     </div></span>
     <!--l. 1611--><p class="noindent" >Of course, you would not normally require both SAMOSA and Anvil for the inner optimization problem. You
     can just comment out either the <span 
class="cmtt-10">par.user.SAMOSA</span><span 
class="cmtt-10">_setup </span>or the <span 
class="cmtt-10">par.user.AnvilPar </span>fields, if you only ant to
     set the problem up for one or the other.
     </li>
     <li 
  class="enumerate" id="x30-43069x4"><a 
 id="dx30-43070"></a> Remember to turn off graphics in the SAMOSA_setup and AnvilSetup files (<span 
class="cmtt-10">par.interface.graphics=-1</span>).
     Also remember to give the names of the two fitness functions:
         <ul class="itemize1">
         <li class="itemize">
         In
         FerretSetup:
         <span 
class="cmtt-10">par.user.fitnessFcn=&#8217;fitnessFerret&#8217;</span>
         </li>
         <li class="itemize">
         In
         SAMOSA_setup:
         <span 
class="cmtt-10">par.user.fitnessFcn=&#8217;fitnessSAMOSA&#8217;</span></li></ul>
     </li>
     <li 
  class="enumerate" id="x30-43072x5"><a 
 id="dx30-43073"></a> The <span 
class="cmmi-10">par </span>structure for SAMOSA and Anvil will be available from within Ferret&#8217;s fitness function as
     <span 
class="cmtt-10">extPar.QubistPar.user.SAMOSA</span><span 
class="cmtt-10">_par </span>and <span 
class="cmtt-10">extPar.QubistPar.user.AnvilPar </span>respectively.
     </li>
     <li 
  class="enumerate" id="x30-43075x6">From within the Ferret fitness function, you can call SAMOSA or Anvil by:
         <ul class="itemize1">
         <li class="itemize">
         <span 
class="cmtt-10">OptimalSolutionsInternal=SAMOSA(extPar.QubistPar.user.SAMOSA</span><span 
class="cmtt-10">_par)</span>
         </li>
         <li class="itemize">
         <span 
class="cmtt-10">OptimalSolutionsInternal=Anvil(extPar.QubistPar.user.AnvilPar)</span></li></ul>
     </li>
     <li 
  class="enumerate" id="x30-43077x7">Extract a single parameter set or fitness value by doing the following:
                                                                                         

                                                                                         
         <ul class="itemize1">
         <li class="itemize">
         <span 
class="cmtt-10">X</span><span 
class="cmtt-10">_SAMOSA=OptimalSolutionsInternal.X(:,1)</span>
         </li>
         <li class="itemize">
         <span 
class="cmtt-10">F</span><span 
class="cmtt-10">_SAMOSA=OptimalSolutionsInternal.F(:,1)</span></li></ul>
     </li>
     <li 
  class="enumerate" id="x30-43079x8">Use these values from within the Ferret fitness function as you wish!
     </li></ol>
<a 
 id="dx30-43080"></a>
<a 
 id="dx30-43081"></a>
<a 
 id="dx30-43082"></a>
<a 
 id="dx30-43083"></a>
<!--l. 1649--><p class="noindent" >
<h4 class="subsectionHead"><span class="titlemark">4.6.3   </span> <a 
 id="x30-440004.6.3"></a>Advanced Technique: Specifying Members of the Initial Population by Hand</h4>
<a 
 id="dx30-44001"></a>
<!--l. 1653--><p class="noindent" >Every once in a while, you might encounter a problem where you have <span 
class="cmti-10">a priori </span>knowledge of good
solutions, based on physical grounds or previous runs. In these cases, it is sometimes useful to specify
some or all of the initial population by hand, rather than allowing Ferret to populate the parameter
space randomly, within the bounds specified by <span 
class="cmtt-10">par.general.min </span>and <span 
class="cmtt-10">par.general.max</span>, which is
the default behaviour. To specify initial parameters by hand, you simply include them as a matrix
<span 
class="cmtt-10">extPar.X0 </span>returned your init file. For example, consider the following init function for a problem with for
parameters:
<!--l. 1663--><p class="noindent" ><span 
class="colorbox" id="colorbox14"> <div class="minipage"><div class="BVerbatimInput"><span 
class="cmtt-10">function</span><span 
class="cmtt-10">&#x00A0;extPar=init</span><br /><span 
class="cmtt-10">X1=[0.1;</span><span 
class="cmtt-10">&#x00A0;0.1;</span><span 
class="cmtt-10">&#x00A0;0.1;</span><span 
class="cmtt-10">&#x00A0;0.1];</span><br /><span 
class="cmtt-10">X2=[0.5;</span><span 
class="cmtt-10">&#x00A0;0.5;</span><span 
class="cmtt-10">&#x00A0;0.5;</span><span 
class="cmtt-10">&#x00A0;0.5];</span><br /><span 
class="cmtt-10">X3=[0.9;</span><span 
class="cmtt-10">&#x00A0;0.9;</span><span 
class="cmtt-10">&#x00A0;0.9;</span><span 
class="cmtt-10">&#x00A0;0.9];</span><br /><span 
class="cmtt-10">extPar.X0=[X1,</span><span 
class="cmtt-10">&#x00A0;X2,</span><span 
class="cmtt-10">&#x00A0;X3];</span></div>
</div></span>
<a 
 id="dx30-44007"></a>
<!--l. 1671--><p class="noindent" >In this case, the user specifies three solutions <span 
class="cmmi-10">X</span>1, <span 
class="cmmi-10">X</span>2, and <span 
class="cmmi-10">X</span>3, and joins them as columns of a matrix <span 
class="cmtt-10">extPar.X0</span>,
which is returned by the function. These three parameter sets are guaranteed to be present in the initial population,
and if they are indeed good solutions, they should propagate throughout the population and give
your run a head start. A single parameter set can be specified as a column vector. Note that it is not
necessary to evaluate the fitness values of <span 
class="cmtt-10">extPar.X0</span>, since Ferret will do this automatically during
initialization. The matrix <span 
class="cmtt-10">extPar.X0 </span>will be truncated if the number of columns exceeds the population
size.
<a 
 id="dx30-44008"></a>
<!--l. 1675--><p class="noindent" >
                                                                                         

                                                                                         
<h4 class="subsectionHead"><span class="titlemark">4.6.4   </span> <a 
 id="x30-450004.6.4"></a>Minimizing Disk Usage</h4>
<a 
 id="dx30-45001"></a>
<!--l. 1679--><p class="noindent" >The structure returned by the init function (<span 
class="cmmi-10">extPar</span>) is passed to the user&#8217;s fitness function every time it is
evaluated. For many problems, <span 
class="cmmi-10">extPar </span>can be quite a large, complicated structure, with many branches.
Nevertheless, it is almost always more efficient to put loaded data in <span 
class="cmmi-10">extPar </span>and pass it to the fitness function,
rather than re-loading the data with each call to the fitness function. The function signature of the fitness function
is given in the section on fitness functions.
<!--l. 1681--><p class="noindent" >The location of the History file directory is determined by the <span 
class="cmtt-10">par.history.dataDir </span>field of the setup file, but the
default location is [projectDir]/FerretData/History, where [projectDir] is the project directory specified in the
launch file. History files contain cell arrays of MATLAB structures that can be loaded and explored at the MATLAB
prompt, as discussed in Section <a 
href="QubistHTMLse26.html#x43-680004.16.4">4.16.4<!--tex4ht:ref: sec:History_files --></a>.
<a 
 id="dx30-45002"></a>
<a 
 id="dx30-45003"></a>
<!--l. 1685--><p class="noindent" >It is important to realize that, by default, a copy of <span 
class="cmmi-10">extPar </span>is saved with <span 
class="cmti-10">every </span>generation in the
History files that Ferret generates while it is running. These files can become quite large if <span 
class="cmmi-10">extPar</span>
contains a lot of data, and this can cause problems on systems without much memory, when the History
files are later reloaded and compared to construct the optimal set (see Section <a 
href="QubistHTMLse25.html#x42-630004.15">4.15<!--tex4ht:ref: sec:analysis --></a>).  Fortunately,
there is a mechanism to limit the amount of data saved by telling Ferret to save only one copy of
selected data-rich branches of the <span 
class="cmmi-10">extPar </span>structure, in the first generation of the first History file. Later
generations and other History files will not contain the selected fields and will be much smaller. This is done
by including a field called <span 
class="cmtt-10">extPar.noSave </span>in the <span 
class="cmmi-10">extPar </span>structure, and setting it to &#8216;1&#8217; or &#8216;true&#8217;, as
follows:
<!--l. 1701--><p class="noindent" ><span 
class="colorbox" id="colorbox15"> <div class="minipage"><div class="BVerbatimInput"><span 
class="cmtt-10">function</span><span 
class="cmtt-10">&#x00A0;extPar=init</span><br /><span 
class="cmtt-10">%</span><br /><span 
class="cmtt-10">%</span><span 
class="cmtt-10">&#x00A0;Physical</span><span 
class="cmtt-10">&#x00A0;Constants.</span><br /><span 
class="cmtt-10">extPar.K.c=299792458;</span><span 
class="cmtt-10">&#x00A0;%</span><span 
class="cmtt-10">&#x00A0;Speed</span><span 
class="cmtt-10">&#x00A0;of</span><span 
class="cmtt-10">&#x00A0;light</span><span 
class="cmtt-10">&#x00A0;in</span><span 
class="cmtt-10">&#x00A0;m/s</span><br /><span 
class="cmtt-10">extPar.K.G=6.67300e-11</span><span 
class="cmtt-10">&#x00A0;%</span><span 
class="cmtt-10">&#x00A0;Gravitational</span><span 
class="cmtt-10">&#x00A0;constant</span><span 
class="cmtt-10">&#x00A0;in</span><span 
class="cmtt-10">&#x00A0;SI</span><span 
class="cmtt-10">&#x00A0;units</span><span 
class="cmtt-10">&#x00A0;[m^3</span><span 
class="cmtt-10">&#x00A0;kg^-1</span><span 
class="cmtt-10">&#x00A0;s^-2]</span><br /><span 
class="cmtt-10">extPar.K.hbar=1.05457148e-34;</span><span 
class="cmtt-10">&#x00A0;%</span><span 
class="cmtt-10">&#x00A0;Heisenberg&#8217;s</span><span 
class="cmtt-10">&#x00A0;constant</span><span 
class="cmtt-10">&#x00A0;in</span><span 
class="cmtt-10">&#x00A0;SI</span><span 
class="cmtt-10">&#x00A0;units</span><span 
class="cmtt-10">&#x00A0;[m^2</span><span 
class="cmtt-10">&#x00A0;kg</span><span 
class="cmtt-10">&#x00A0;s^-1]</span><br /><span 
class="cmtt-10">%</span><br /><span 
class="cmtt-10">%</span><span 
class="cmtt-10">&#x00A0;Data.</span><br /><span 
class="cmtt-10">extPar.data=load(&#8217;hugeDataFile&#8217;);</span><br /><span 
class="cmtt-10">extPar.data.otherData=load(&#8217;moreData&#8217;);</span><br /><span 
class="cmtt-10">extPar.data.noSave=true;</span></div>
</div></span>
<!--l. 1707--><p class="noindent" >Note that &#8216;noSave&#8217; must be specified <span 
class="cmti-10">on the same level </span>in the structure as the data field that is not to be saved with
every generation. In this case, Ferret will not save multiple copies of &#8216;data&#8217; or the &#8216;otherData&#8217; field below it, but
every generation will be saved with a copy of the physical constants in <span 
class="cmtt-10">extPar.K</span>. In practice, this is a
reasonable way of doing things because it is convenient for post-run analysis to have quick access to small
structures like physical constants, etc. in each saved generation, but saving multiple copies of data
or other large structures is wasteful of disk space. If you are a minimalist and don&#8217;t want multiple
copies of <span 
class="cmti-10">any </span>of the <span 
class="cmmi-10">extPar </span>fields to be saved, except for in the first generation of the first History
file, just include the noSave directive on the top level of the <span 
class="cmmi-10">extPar </span>structure defined in your init
file:
<!--l. 1714--><p class="noindent" ><span 
class="colorbox" id="colorbox16"> <div class="minipage"><div class="BVerbatimInput"><span 
class="cmtt-10">function</span><span 
class="cmtt-10">&#x00A0;extPar=init</span><br /><span 
class="cmtt-10">...</span><br /><span 
class="cmtt-10">extPar.noSave=true;</span></div>
</div></span>
<a 
 id="dx30-45018"></a>
<a 
 id="dx30-45019"></a>
<a 
 id="dx30-45020"></a>
                                                                                         

                                                                                         
<!--l. 1725--><div class="crosslinks"><p class="noindent">[<a 
href="QubistHTMLse17.html" >next</a>] [<a 
href="QubistHTMLse15.html" >prev</a>] [<a 
href="QubistHTMLse15.html#tailQubistHTMLse15.html" >prev-tail</a>] [<a 
href="QubistHTMLse16.html" >front</a>] [<a 
href="QubistHTMLch4.html#QubistHTMLse16.html" >up</a>] </p></div>
<!--l. 1725--><p class="noindent" ><a 
 id="tailQubistHTMLse16.html"></a>  
</body></html> 
